# 计算机网络概述

今天我们要学习的是计算机网络以及如何将其与操作系统关联起来。今天的lab也是最后一个，是让你写一个Network interface driver网卡驱动。这节课，我们首先会大概看一下操作系统中网络相关的软件是个什么结构，之后我们讨论今天的论文[Livelock](https://pdos.csail.mit.edu/6.828/2020/readings/mogul96usenix.pdf)，livelock向我们展示了网络协议栈中一些有趣的危险。

首先，让我通过画图来描述一下基本的网络场景。网络是干啥的，是用来连接不同计算机的，连接的方式主要有两种。

一种连接是对于那些互相离得很近的主机（注，hosts），这种情况，这些主机通常都属于同一个Network中。例如有一个Ethernet设备，可能是交换机或者单纯的线缆，然后这些主机统统连接到这个Ethernet设备。这里的主机可能是笔记本电脑，服务器，路由器。<font color=red>在设计网络相关软件的时候，通常会忽略直接连接了主机的网络设备。这里的网络设备可能只是一根线缆（几十年前就是通过线缆连接主机）；也可能是一个以太网交换机；也可能是wifi无线局域网设备（主机通过射频链路与网络设备相连），但是不管是哪种设备，这种直接连接的设备会在网络协议栈的底层被屏蔽掉。</font>这里听的不是很懂

每个主机上可能都运行着网络应用程序，一个web浏览器，另一个主机运行着http服务器，它们通过这个网络进行通信。

![img](.assets/image%20(419)%20(2).png)

一个局域网的大小是有极限的。局域网（Local Area Network）通常简称LAN。一个局域网需要能让其中所有的主机都能收到彼此发送的packet（注，二层广播域？）。也就是说，有时主机想要广播packet到局域网中所有的主机。当局域网中有20,50甚至100个主机时，这都没啥问题，但是不能构建超过几百个主机的局域网。

所以为了解决这个问题，大型的网络是这么构建的。首先有多个单独的LANs，假设其中一个属于MIT，另一个属于Harvard，还有一个属于Stanford，在这些局域网之间会有一些设备将它们连在一起，这东西叫做路由器。其中一个Router接入到了MIT的局域网，同时也接入到了Harvard的局域网。

![img](.assets/image%20(786).png)

路由器是组成互联网的核心，路由器之间的链路，最终将多个局域网连接在了一起。

![img](.assets/image%20(767).png)

现在MIT有个主机想与Stanford的主机通信，它们之间的通信需要经过一系列路由器，路由器之间的转发称为Routing。所以我们需要有个方法让MIT的主机能够寻址到Stanford的主机，所以我们需要让连接MIT的路由器能够在收到MIT主机的packet时候，知道这个packet是发送给Stanford的，而不是发送给Harvard，也不是发送到日本的。

从网络协议的角度来说，局域网内部通信由Ethernet protocols负责，而局域网之间的行距离网络通信则由Internet protocols负责。以上就是网络的概述。

接下来我想介绍一下，在局域网和互联网上传递的packet有什么样的结构，之后再讨论在主机和路由器中的软件是如何处理这些packet。