# RISC-V VS x86

[toc]

你将会发现，本门课程说的汇编指的是RISC-V汇编，处理器指的是RISC-V处理器。有很多不同的汇编语言，如果你使用RISC-V汇编语言的话，你不大可能在上面运行Linux。大多数现代计算机都是运行在x86或者x86-64处理器上面的。x86或者x86-64是与RISC-V不同的ISA，通常个人电脑上运行的处理器都是x86的，Intel和AMD的CPU都实现了x86。

![img](.assets/image%20(351).png)

RISC-V和x86并没有它们第一眼看起来那么相似。RISC-V中的RISC指的是精简指令集的意思（reduced instruction set）,而x86通常也被称为CISC即复杂指令集（complex instructions set）。这两者之间有一些关键的区别：

* x86-64中的指令的数量，实际上，创造RISC-V的一个初衷就是Intel手册中的指令太多了。x86-64指令介绍由3个文档组成，并且以每月3个的数量增加。所以现在大约有15000条指令。另一方面，RISC-V的汇编指令介绍只有两个文档。本门可能不要求你记住每条RISC-V的指令，但是如果你对哪条指令感兴趣或者疑惑的话，可以去课程网页面点击链接查询RISC-V的文档。这两个文档包含了RISC-V指令集的所有内容。一个240页一个135页，这比x86-64的指令集文档小太多太多。这就是RISC-V比较好的一面，即更少的指令数量。

* RISC-V指令也不单单数量少这方面，其指令也很简单。在x86-64中很多指令都做了不止一件事情，这些指令执行了一系列复杂的操作并返回结果。RISC-V的指令不会这么做，RISC-V的指令趋向于完成更简单的工作，相应的也消耗更少的CPU时间。这其实是设计者的取舍，所以没有什么规范或者标准说RISC比CISC更好，它们各自有各自的使用场景等等。

* 另一件RISC-V很酷的事情，相对于x86来说的是，RISC-V是开源的。是市场上唯一来源的指令集。这意味任何人都可以为RISC-V开发一块板子，RISC-V来自于UC-Berkeley一个研究项目，是RISC-V开始的地方。之后RISC-V赢得了很多公司的支持，你可以在网上找到这些公司的名单，因为很多大公司对于支持一个开源的指令集很感兴趣。

我记得最近，作为主要的RISC-V处理器生产商，SiFive宣称会发布一款基于RISC-V的主板，用来在个人计算机上运行Linux系统。如果你好奇或者想要使用RISC-V，在你学完了6.S081之后，大概率你可以在你的个人电脑上通过RISC-V处理器运行Linux。

在日常生活中，你们可能已经在不知不觉中使用了精简指令集。ARM就是一个精简指令集，ARM是由高通实现的，snapdragon系列处理器。所以如果你使用一个Android手机，那么你大概率使用了精简指令集。如果你使用的是IOS手机，苹果公司也实现了某种版本的ARM指令集，实现了这种版本的ARM指令集的处理器运行在iPad，iPhone与其他的苹果移动设备上。所以精简指令集出现在各种各样的地方。如果你想在现实中发现RISC-V处理器，你可能在很多嵌入式设备中找到。所以RISC-V也是存在的，就是没有x86那么流行而已。

![img](.assets/image%20(342).png)

去年确实有一股精简指令集的热潮。鉴于x86指令集太大了，而它之所以这么大的原因是Intel很看重它的后向兼容性。一个现在的Intel处理器还可以运行30/40年前的指令。Intel没有废弃任何指令以保证其向后的兼容性。

>学生问：为什么x86会有15000条指令？
>
>TA：正如我刚才所说的，我们需要很多指令是为了向后兼容性。而向后兼容性是否重要则因人而异。另一方面，我认为这里很多指令都是CMD指令，用来完成一些特殊的操作。我从来就没见过Intel的汇编代码使用了所有的15000个指令。大多数这些指令都是为了向后兼容和cmd的需求创建。

如果查看RISC-V的文档，可以发现RISC-V的特殊之处在于：它区分了Base Integer Instruction Set和Standard Extension Instruction Set。RISC-V有一个Base integer instruction Set包含了所有的正常的add，multiply运算等。除此之外，如果你想让处理器支持standard Extension Instruction Set来计算单精度，或浮点型，那么你可以让处理器包含F module即可。这样会使得RISC-V更容易支持向后兼容性。 每一个RISC-V处理器可以声明支持了哪些扩展指令集，然后编译器可以根据支持的指令集来编译代码。

>学生问：现在看相比于RISC-V，使用x86的唯一优势就是提高性能。但是这里的性能是以复杂度和潜在的安全为代价的，我的问题是为什么我们还在使用x86，而不是使用RISC-V处理器？
>
>TA：现在整个世界都是运行在x86上的，我也没有一个很好的答案。RISC-V是很现代，但是现在突然把处理器都换成RISC-V，那么你就会失去很多重要的支持（软件层面上的）。同时Intel在它的处理器里面做了很多有意思的事情，比如安全方面的Enclave，给用户提供安全上的保证。还有一些Intel的指令在做某些特定运算时会十分高效。几乎每个场景相比于RISC-V来说Intel都有十分高效的指令。这个问题更实际的答案可能是RISC-V是个相对较新的架构，现在还没有人使用RISC-V来制造个人电脑，SiFive是第一批这样做的公司。所以从实际角度来说，因为不能再RISC-V上运行所有为Intel设计的软件，是我对这个问题的最好答案。



## 模糊点

1.指令集开源，怎么理解。

